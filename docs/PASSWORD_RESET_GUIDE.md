# Password Reset Guide for Database Users

This guide explains how to reset passwords for users who don't have passwords set in the database.

## Overview

Your system uses bcrypt with 12 salt rounds for password hashing. When a user is manually added to the database without a password, you can reset it using the following methods.

## Method 1: Using the Password Hash Generator Script (Recommended)

### Step 1: Generate a bcrypt hash

Use the provided script to generate a secure bcrypt hash:

```bash
node scripts/generate-password-hash.js "YourNewPassword123!"
```

This will output:
- The generated bcrypt hash
- Ready-to-use SQL queries

### Step 2: Execute the SQL query

Choose the appropriate SQL query based on how you want to identify the user:

**By Username:**
```sql
UPDATE Users 
SET passwordhash = '$2b$12$IFBmv5j6BrYlf1XJmBJPw.v7c71yVaOEJ9mPjx13mD/saokRtBFwm', 
    salt = NULL, 
    updatedat = NOW() 
WHERE username = 'user@example.com';
```

**By Email:**
```sql
UPDATE Users 
SET passwordhash = '$2b$12$IFBmv5j6BrYlf1XJmBJPw.v7c71yVaOEJ9mPjx13mD/saokRtBFwm', 
    salt = NULL, 
    updatedat = NOW() 
WHERE email = 'user@example.com';
```

**By User ID:**
```sql
UPDATE Users 
SET passwordhash = '$2b$12$IFBmv5j6BrYlf1XJmBJPw.v7c71yVaOEJ9mPjx13mD/saokRtBFwm', 
    salt = NULL, 
    updatedat = NOW() 
WHERE id = 123;
```

## Method 2: Using the API Endpoint

If you have access to the API, you can use the existing password update endpoint:

```bash
curl -X PUT http://your-api-domain/api/update-password \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "user@example.com",
    "newPassword": "NewSecurePass123!"
  }'
```

## Method 3: Direct Database Update (Advanced)

If you need to set a password directly in the database without using the script:

1. **Generate a bcrypt hash manually** using any bcrypt generator
2. **Use the hash in your SQL query** (same format as above)

## Password Requirements

Your system enforces these password requirements:
- Minimum 8 characters
- At least 1 uppercase letter
- At least 1 lowercase letter  
- At least 1 number
- At least 1 special character

## Security Notes

1. **Always use strong passwords** that meet the system requirements
2. **Set salt to NULL** when updating passwords (bcrypt handles salting internally)
3. **Update the updatedat timestamp** to ensure proper audit trails
4. **Consider setting updatedbyid** if you want to track who made the change
5. **Communicate the new password securely** to the user
6. **Encourage the user to change their password** on first login

## Example Workflow

1. **Identify the user** who needs a password reset
2. **Generate a temporary password** that meets requirements
3. **Run the hash generator script** with the temporary password
4. **Execute the SQL query** to update the user's password
5. **Communicate the temporary password** to the user securely
6. **Instruct the user to change their password** on first login

## Troubleshooting

### Common Issues:

1. **Hash not working**: Ensure you're using the exact hash generated by the script
2. **User not found**: Double-check the username/email/user ID
3. **Password requirements**: Make sure the password meets all requirements
4. **Database permissions**: Ensure you have UPDATE permissions on the Users table

### Verification:

After updating the password, you can verify it works by:
1. Attempting to log in with the new password
2. Checking the user's `updatedat` timestamp was updated
3. Confirming the `salt` field is NULL

## Database Schema Reference

The Users table structure relevant to password management:

```sql
CREATE TABLE Users (
  id INT PRIMARY KEY AUTO_INCREMENT,
  username VARCHAR(255),
  email VARCHAR(255),
  passwordhash VARCHAR(255),  -- Stores bcrypt hash
  salt VARCHAR(255),          -- Should be NULL for bcrypt passwords
  updatedat TIMESTAMP,
  updatedbyid INT,
  -- ... other fields
);
```

## Best Practices

1. **Use temporary passwords** that are easy to communicate but secure
2. **Set password expiration** if your system supports it
3. **Log password changes** for audit purposes
4. **Use secure communication channels** to share temporary passwords
5. **Implement password reset workflows** for future use
6. **Regular security audits** of password practices 